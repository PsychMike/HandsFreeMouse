<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>ivis: +ivis/+main/IvMain.m Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="D:\Dropbox\MatlabToolkits\ivis\admin\resources\branding\logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">ivis
   &#160;<span id="projectnumber">1.5</span>
   </div>
   <div id="projectbrief">Realtime eyetracking toolbox</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_iv_main_8m_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">IvMain.m</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_iv_main_8m.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">namespace </span>ivis{</div>
<div class="line"><a name="l00002"></a><span class="lineno"><a class="code" href="namespaceivis_1_1main.html">    2</a></span>&#160;<span class="keyword">namespace </span>main{</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">/* (Autoinserted by mtoc++)</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * This source code has been filtered by the mtoc++ executable,</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * which generates code that can be processed by the doxygen documentation tool.</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * On the other hand, it can neither be interpreted by MATLAB, nor can it be compiled with a C++ compiler.</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * Except for the comments, the function bodies of your M-file functions are untouched.</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * Consequently, the FILTER_SOURCE_FILES doxygen switch (default in our Doxyfile.template) will produce</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * attached source files that are highly readable by humans.</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * Additionally, links in the doxygen generated documentation to the source code of functions and class members refer to</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * the correct locations in the source code browser.</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * However, the line numbers most likely do not correspond to the line numbers in the original MATLAB source files.</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div>
<div class="line"><a name="l00019"></a><span class="lineno"><a class="code" href="classivis_1_1main_1_1_iv_main.html">   19</a></span>&#160;<span class="keyword">class </span><a class="code" href="classivis_1_1main_1_1_iv_main.html" title="Main (static) class for initialising and shutting down ivis. Should be the first and last ivis comman...">IvMain</a></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  :public ::handle {</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        <span class="comment">/* % ====================================================================</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">     *  -----STATIC METHODS (public)-----</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">     *$ ==================================================================== */</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    </div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keyword">public</span>: <span class="comment">/* ( Static ) */</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div>
<div class="line"><a name="l00064"></a><span class="lineno"><a class="code" href="classivis_1_1main_1_1_iv_main.html#a59e9da3cefce3da3fac5dc89c0f5591e">   64</a></span>&#160;        <span class="keyword">static</span> noret::substitute <a class="code" href="classivis_1_1main_1_1_iv_main.html#a59e9da3cefce3da3fac5dc89c0f5591e" title="Check for bad java class path...">checkClassPath</a>() {</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;            tmp = javaclasspath(<span class="stringliteral">&quot; -dynamic &quot;</span>);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;            FlushEvents()</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;            AssignGetCharJava();</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;            <span class="keywordflow">if</span> length(tmp) ~= length(javaclasspath(<span class="stringliteral">&quot; -dynamic &quot;</span>))</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                <span class="comment">/*  MATLAB calls the clear java command whenever you change</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">                 * the dynamic path. This command clears the definitions of</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">                 * all Java classes defined by files on the dynamic class</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">                 * path, removes all variables from the base workspace, and</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">                 * removes all compiled scripts, functions, and</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">                 * MEX-functions from memory. */</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                error(<span class="stringliteral">&quot; nIvMain:MemoryCleared &quot;</span>,<span class="stringliteral">&quot; PTB has modified the java classpath (any items in memory will have been cleared)\nWill abort, since this is highly likely to lead to errors later.\n\nTry running again, or see  &quot;</span><span class="stringliteral">&quot; help PsychJavaTrouble &quot;</span><span class="stringliteral">&quot;  for a more permanant solution\n\nFYI: the solution, in short is to open up the matlab classpath.txt file, and manually add the necessary locations. For example, for me I opened up:\n\n  %s\n\nand at the end of the file I added these two lines:\n\n  %s\n  %s\n\nand then I restarted Matlab\n\n\ntl;dr: try running script again (or edit classpath.txt). &quot;</span>, <span class="stringliteral">&quot; C:\Program Files\MATLAB\R2016b\toolbox\local &quot;</span>, <span class="stringliteral">&quot; C:\Users\petej\Dropbox\MatlabToolkits\Psychtoolbox\PsychJava &quot;</span>, <span class="stringliteral">&quot; C:\Users\petej\Dropbox\MatlabToolkits\PsychTestRig\Utilities\memory\MatlabGarbageCollector.jar &quot;</span>);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;            end</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        }</div>
<div class="line"><a name="l00088"></a><span class="lineno"><a class="code" href="classivis_1_1main_1_1_iv_main.html#a71ff1cf2f841d66b487076c87fe417ce">   88</a></span>&#160;        <span class="keyword">static</span> noret::substitute <a class="code" href="classivis_1_1main_1_1_iv_main.html#a71ff1cf2f841d66b487076c87fe417ce" title="Validate specified version number against the installed version of ivis.">assertVersion</a>(matlabtypesubstitute vernum) {</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;            <span class="keywordflow">if</span> verLessThan(<span class="stringliteral">&quot; ivis &quot;</span>,num2str(vernum))</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                error(<span class="stringliteral">&quot; IvMain:InvalidInput: The version of ivis you specified in your config (%g) is greater than the currently installed version (%s).\n\n &quot;</span>, vernum, getversion(<span class="stringliteral">&quot; ivis &quot;</span>));</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            end</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            <span class="keywordflow">if</span> verGreaterThan(<span class="stringliteral">&quot; ivis &quot;</span>,num2str(vernum))</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                str = sprintf(<span class="stringliteral">&quot; The version of ivis you specified (%g) is less than the currently installed version (%s).\n\nThis could cause problems if any of the core functions have been modified or depreciated.\n\n &quot;</span>, vernum, getversion(<span class="stringliteral">&quot; ivis &quot;</span>));</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                <span class="keywordflow">if</span> ~getLogicalInput([str <span class="stringliteral">&quot; continue (y/n)?  &quot;</span>]);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                    error(<span class="stringliteral">&quot; Aborted by user &quot;</span>);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                end</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;            end</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        }</div>
<div class="line"><a name="l00113"></a><span class="lineno"><a class="code" href="classivis_1_1main_1_1_iv_main.html#a86785c469028ed3bd3fe14675ddc8b98">  113</a></span>&#160;        <span class="keyword">static</span> mlhsInnerSubst&lt;matlabtypesubstitute,params&gt; <a class="code" href="classivis_1_1main_1_1_iv_main.html#a86785c469028ed3bd3fe14675ddc8b98" title="Validate IvConfig parameters.">validate</a>(matlabtypesubstitute paramStructOrXmlFullFileName) {</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;            <span class="keywordflow">if</span> nargin&lt;1</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                paramStructOrXmlFullFileName = [];</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            end</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;            <span class="comment">/*  ensure classpath has been set */</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            ivis.main.IvMain.checkClassPath();</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;            <span class="comment">/* --------------------------------------------------------------</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">             * init Params %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">             * load/parse/validate user-specified parameters */</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;            params = ivis.main.IvParams(paramStructOrXmlFullFileName);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;            <span class="comment">/*  validate data input */</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            ivis.eyetracker.IvDataInput.validateSubclass(params.eyetracker);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        }</div>
<div class="line"><a name="l00144"></a><span class="lineno"><a class="code" href="classivis_1_1main_1_1_iv_main.html#aab425123f77e446b64088251a8cefaa4">  144</a></span>&#160;        <span class="keyword">static</span> mlhsInnerSubst&lt;matlabtypesubstitute,params&gt; <a class="code" href="classivis_1_1main_1_1_iv_main.html#aab425123f77e446b64088251a8cefaa4" title="Load/parse the params (if an xml file file specified), and validate the contents. Must be called prio...">initialise</a>(matlabtypesubstitute paramStructOrXmlFullFileName) {</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;            <span class="comment">/*  check current directory is valid */</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            <span class="keywordflow">if</span> ~isempty(regexp(pwd(), <span class="stringliteral">&quot; Windows\\system32$ &quot;</span>, <span class="stringliteral">&quot; once &quot;</span>))</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                error(<span class="stringliteral">&quot; IvMain:InvalidPath &quot;</span>, <span class="stringliteral">&quot; Trying to run Matlab from the Windows system32 folder is not a good idea.\nChange the current working directory and try again. &quot;</span>);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            end</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            <span class="comment">/*  initialise memory</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">             * clearJavaMem(); % disabled: might cause problems if initialising after a PTB window has been opened(?) */</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            <span class="comment">/*  start logging the command window */</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            fn = sprintf(<span class="stringliteral">&quot; commandline-%s.txt &quot;</span>, datestr(now(),30));</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            fullFn = fullfile(ivisdir(), <span class="stringliteral">&quot; logs &quot;</span>, <span class="stringliteral">&quot; diary &quot;</span>, fn);</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">/*  fullFn = fn            */</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;fclose(fopen(fullFn, <span class="stringliteral">&quot; wt &quot;</span>)); <span class="comment">/*  make file */</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            diary(fullFn); <span class="comment">/*  start diary */</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            <span class="comment">/*  (load and) validate ivis launch parameters */</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            params = ivis.main.IvMain.validate(paramStructOrXmlFullFileName);</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        }</div>
<div class="line"><a name="l00183"></a><span class="lineno"><a class="code" href="classivis_1_1main_1_1_iv_main.html#ab8e98d451a2dc067f53ea8032393a89d">  183</a></span>&#160;        <span class="keyword">static</span> mlhsSubst&lt;mlhsInnerSubst&lt;matlabtypesubstitute,dataInput&gt; ,mlhsInnerSubst&lt;matlabtypesubstitute,logs&gt; ,mlhsInnerSubst&lt;matlabtypesubstitute,InH&gt; ,mlhsInnerSubst&lt;matlabtypesubstitute,winhandle&gt; ,mlhsInnerSubst&lt;matlabtypesubstitute,params&gt; &gt; <a class="code" href="classivis_1_1main_1_1_iv_main.html#ab8e98d451a2dc067f53ea8032393a89d" title="Open connections and ready outputs.">launch</a>(matlabtypesubstitute screennum,matlabtypesubstitute InH) {</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            <span class="comment">/*  Import packages */</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;            <span class="keyword">import</span> ivis.audio.* ivis.video.* ivis.classifier.* ivis.control.* ivis.log.* ivis.eyetracker.* ivis.calibration.* ivis.graphic.* ivis.gui.* ivis.io.* ivis.main.* ivis.resources.* ivis.simulation.* ivis.test.* ivis.math.*;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            <span class="comment">/*  Parse inputs */</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            <span class="keywordflow">if</span> nargin &lt; 1</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                screennum = [];</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            elseif <a class="code" href="namespaceivis_1_1broadcaster.html#a035702262427ed8c3b5b3d6d6d025b02" title="SCREEN wrapper for PTB&#39;s Screen command.">Screen</a>(screennum, <span class="stringliteral">&quot; WindowKind &quot;</span>)</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                error(<span class="stringliteral">&quot; a:b &quot;</span>,<span class="stringliteral">&quot; invalid, screennum appears to be a handle to an already extant window? If you want to use your own window then use the screennum instead, and then call IvParams.registerScreen(winhandle) after this.\n\nThis is necessary because it is important to open up ivis before opening a PTB screen, otherwise the GUI may fail. &quot;</span>)</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;            end</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            <span class="keywordflow">if</span> nargin &lt; 2</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                InH = [];</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            end</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            <span class="comment">/*  get params */</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;params = <a class="code" href="classivis_1_1main_1_1_iv_params.html" title="Responsible for loading, parsing and validating inputs stored in Config.xml, and storing the system v...">IvParams</a>.<a class="code" href="classivis_1_1main_1_1_iv_params.html#a585be903f73199977df02b4284e966c9">getInstance</a>();</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            <span class="comment">/*  print messsage to console */</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            <span class="keywordflow">if</span> params.main.verbosity &gt; 0</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                fprintf(<span class="stringliteral">&quot; IVIS: launching...\n &quot;</span>);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            end</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            <span class="comment">/*  init. Close figures:</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment"> *             try</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment"> *                 close all;</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment"> *                 close(&#39;all&#39;, &#39;hidden&#39;);</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment"> *             catch  %#ok do nothing</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment"> *             end</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment"> *             % Closing figures might fail if the CloseRequestFcn of a figure</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment"> *             % blocks the execution. Fallback:</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment"> *             AllFig = allchild(0);</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment"> *             if ~isempty(AllFig)</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment"> *                 set(AllFig, &#39;CloseRequestFcn&#39;, &#39;&#39;, &#39;DeleteFcn&#39;, &#39;&#39;);</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment"> *                 delete(AllFig);</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment"> *             end */</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            <span class="keywordflow">try</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                length(javaclasspath(<span class="stringliteral">&quot; -dynamic &quot;</span>));</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                <span class="comment">/*  check for bad java class path.. */</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                ivis.main.IvMain.checkClassPath();</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                <span class="comment">/* --------------------------------------------------------------</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">                 * make GUI %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">                 * create a GUI shell (will add content panels to it later)</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">                 * n.b. moved to before screen opening to ensure that</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">                 * figures are tiled even if a fullscreen window is open</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">                 * (otherwise seems to struggle to set focus on the dock) */</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                <span class="keywordflow">if</span> params.GUI.useGUI</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                    IvGUI(params.GUI.screenNum);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                end</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                <span class="comment">/* --------------------------------------------------------------</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">                 * init Psychtoolbox, open test window %%%%%%%%%%%%%%%%%%%%%%%%% */</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                winhandle = [];</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                <span class="keywordflow">if</span> params.graphics.useScreen</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                    <span class="comment">/* if ~isempty(winhandle)</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">                     *    warning(&#39;IvMain:InvalidInput&#39;,&#39;You have requested to use a Screen, but have passed in an already extant PTB screen handle\nWill just use that instead&#39;);</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">                     *else</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">                         * PTB-3 correctly installed and functional? Abort otherwise. */</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                        AssertOpenGL;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                        <span class="comment">/*  !!!!required to work on slow computers!!! Use with caution!!!!! */</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                        <a class="code" href="namespaceivis_1_1broadcaster.html#a035702262427ed8c3b5b3d6d6d025b02" title="SCREEN wrapper for PTB&#39;s Screen command.">Screen</a>(<span class="stringliteral">&quot; Preference &quot;</span>, <span class="stringliteral">&quot; SkipSyncTests &quot;</span>, 2);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                        <span class="comment">/*  Cache key timing functions</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">                         * KbCheck(); */</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                        WaitSecs(0.0000001);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                        <span class="comment">/*  Setup Psychtoolbox for OpenGL 3D rendering support and initialize the</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">                         * mogl OpenGL for Matlab wrapper: */</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                        InitializeMatlabOpenGL(1);</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                        <span class="comment">/*  Open a double-buffered full-screen window on the main displays screen. */</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                        PsychImaging(<span class="stringliteral">&quot; PrepareConfiguration &quot;</span>);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                        PsychImaging(<span class="stringliteral">&quot; AddTask &quot;</span>, <span class="stringliteral">&quot; General &quot;</span>, <span class="stringliteral">&quot; FloatingPoint32BitIfPossible &quot;</span>);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                        <span class="comment">/*  Find the color values which correspond to white and black: Usually</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment">                         * black is always 0 and white 255, but this rule is not true if one of</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">                         * the high precision framebuffer modes is enabled via the</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">                         * PsychImaging() commmand, so we query the true values via the</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">                         * functions WhiteIndex and BlackIndex: */</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                        white = WhiteIndex(params.graphics.testScreenNum);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                        black = BlackIndex(params.graphics.testScreenNum);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                        <span class="comment">/*  Round gray to integral number, to avoid roundoff artifacts with some</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">                         * graphics cards: */</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                        gray = round((white+black)/2);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                        <span class="comment">/*  This makes sure that on floating point framebuffers we still get a</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">                         * well defined gray. It isn&#39;t strictly neccessary in this demo: */</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                        <span class="keywordflow">if</span> gray == white</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                            gray = white/2;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                        end</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                        <span class="comment">/*  OPEN SCREEN! */</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                        winRect = [0 0 params.graphics.testScreenWidth params.graphics.testScreenHeight];</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                        <span class="keywordflow">if</span> all(winRect == <a class="code" href="namespaceivis_1_1broadcaster.html#a035702262427ed8c3b5b3d6d6d025b02" title="SCREEN wrapper for PTB&#39;s Screen command.">Screen</a>(<span class="stringliteral">&quot; Rect &quot;</span>, params.graphics.testScreenNum))</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                            winRect = []; <span class="comment">/*  on windows at least, passing coordinates seems to assume screen 0 */</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                        end</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                        winhandle = PsychImaging(<span class="stringliteral">&quot; OpenWindow &quot;</span>, params.graphics.testScreenNum, gray, winRect, [], 2);</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                        <span class="comment">/*  Example alternative screen Opening blurb:</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">                         *PsychImaging(&#39;AddTask&#39;, &#39;General&#39;, &#39;EnablePseudoGrayOutput&#39;);</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">                         *winhandle = PsychImaging(&#39;OpenWindow&#39;, params.graphics.testScreenNum);</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">                     *end */</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                    <span class="comment">/*  validate */</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                    maxFlipsPerSecond = 1/<a class="code" href="namespaceivis_1_1broadcaster.html#a035702262427ed8c3b5b3d6d6d025b02" title="SCREEN wrapper for PTB&#39;s Screen command.">Screen</a>(<span class="stringliteral">&quot; GetFlipInterval &quot;</span>, winhandle);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                    <span class="keywordflow">if</span> maxFlipsPerSecond &lt; params.graphics.targFrameRate</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                        <span class="keywordflow">if</span> ~getLogicalInput(sprintf(<span class="stringliteral">&quot; Effective framerate (%1.2f) &lt; requested Fr (%1.2f). Continue? &quot;</span>, params.graphics.targFrameRate, maxFlipsPerSecond));</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                            error(<span class="stringliteral">&quot; a:b &quot;</span>,<span class="stringliteral">&quot; Aborted by user &quot;</span>);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                        end</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                        fprintf(<span class="stringliteral">&quot; \n\n\n!!!!!!WARNING: Effective framerate (%1.2f) &lt; requested Fr (%1.2f)!!!!!!!\n\n\n &quot;</span>, params.graphics.targFrameRate, maxFlipsPerSecond)</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                    end</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                    <span class="comment">/*  initialise text */</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                    <a class="code" href="namespaceivis_1_1broadcaster.html#a035702262427ed8c3b5b3d6d6d025b02" title="SCREEN wrapper for PTB&#39;s Screen command.">Screen</a>(<span class="stringliteral">&quot; TextSize &quot;</span>, winhandle, 40);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                    <a class="code" href="namespaceivis_1_1broadcaster.html#a035702262427ed8c3b5b3d6d6d025b02" title="SCREEN wrapper for PTB&#39;s Screen command.">Screen</a>(<span class="stringliteral">&quot; TextFont &quot;</span>, winhandle, <span class="stringliteral">&quot; Helvetica &quot;</span>);</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                    <span class="comment">/*  reset focus for keyboard (which will have been set to</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">                     * the newly opened window) */</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                    <span class="keywordflow">if</span> ~isempty(InH)</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                        InH.updateFocus(); <span class="comment">/*  to encorporate the newly opened screen */</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                    end</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                end</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                <span class="keywordflow">if</span> ~isempty(winhandle)</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                    <a class="code" href="classivis_1_1main_1_1_iv_params.html" title="Responsible for loading, parsing and validating inputs stored in Config.xml, and storing the system v...">IvParams</a>.<a class="code" href="classivis_1_1main_1_1_iv_params.html#a2d1bc5bf2162b31a97968a56b1ecea68" title="Update graphic parameters based on the specified PTB screen.">registerScreen</a>(winhandle)</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                elseif ~isempty(screennum)</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                    <a class="code" href="classivis_1_1main_1_1_iv_params.html" title="Responsible for loading, parsing and validating inputs stored in Config.xml, and storing the system v...">IvParams</a>.<a class="code" href="classivis_1_1main_1_1_iv_params.html#a2d1bc5bf2162b31a97968a56b1ecea68" title="Update graphic parameters based on the specified PTB screen.">registerScreen</a>(screennum)</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                    warning(<span class="stringliteral">&quot; Running without a screen (N.B. if you intended to open a manual PTB screen then you should have passed the screen number in when you called launch() &quot;</span>);</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                end</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                IvUnitHandler(params.graphics.monitorWidth_cm, params.graphics.testScreenWidth, params.graphics.viewDist_cm);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                <span class="comment">/* --------------------------------------------------------------</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">                 * initialise audio interface %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% */</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                <span class="keywordflow">if</span> params.audio.isConnected</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                    IvAudio(params.audio, params.main.verbosity);</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                end</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                <span class="comment">/* --------------------------------------------------------------</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">                 * initialise video interface %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% */</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                IvVideo.init();</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                <span class="comment">/* --------------------------------------------------------------</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">                 * initialise video interface %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% */</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                <span class="keywordflow">if</span> params.webcam.enable</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                    IvWebcam(params.webcam.GUIidx);</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                end</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                <span class="comment">/* --------------------------------------------------------------</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">                 * make logs %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% */</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                logs.data= IvDataLog(params.log.data.dir, params.log.data.filepattern, params.log.data.arraySize);</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                logs.raw= IvRawLog(params.log.raw.dir, params.log.raw.filepattern);</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                <span class="comment">/* --------------------------------------------------------------</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">                 * make calib %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% */</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;IvCalibration(params.calibration);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                <span class="comment">/* --------------------------------------------------------------</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment">                 * make Data Input (e.g. connect to eye-tracker) %%%%%%%%%%%%%%% */</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                dataInput = [];</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                <span class="keywordflow">if</span> ~isempty(params.eyetracker.type)</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                    dataInput = IvDataInput.init(params.eyetracker, params.saccade);</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                end</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                <span class="comment">/* --------------------------------------------------------------</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">                 * initialise input (e.g., keyboard) interface %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">                 * n.b. now placed after IvGUI to prevent functionality</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">                 * clashes */</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                <span class="keywordflow">if</span> isempty(InH) &amp;&amp; ~isempty(params.keyboard.handlerClass)</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                    InH = feval(params.keyboard.handlerClass, params.keyboard.isAsynchronous, params.keyboard.customQuickKeys, params.keyboard.warnUnknownInputsByDefault);</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                end</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                <span class="comment">/* ----------------------------------------------------------</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">                 * flush the keyboard input %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% </span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">                 * Some scripts (particularly the GUI hacks, simulate</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">                 * keystrokes, so get rid of those to avoid them lingering</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">                 * in the buffer) */</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                <span class="keywordflow">if</span> ~isempty(InH)</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                    InH.getInput();</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                end</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                <span class="comment">/*  get params anew (in case anything has been updated, e.g.</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">                 * in terms of graphics parameters) */</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                params = <a class="code" href="classivis_1_1main_1_1_iv_params.html" title="Responsible for loading, parsing and validating inputs stored in Config.xml, and storing the system v...">IvParams</a>.<a class="code" href="classivis_1_1main_1_1_iv_params.html#a585be903f73199977df02b4284e966c9">getInstance</a>();</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                <span class="comment">/*  print messsage to console */</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                <span class="keywordflow">if</span> params.main.verbosity &gt; 0</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                    fprintf(<span class="stringliteral">&quot; IVIS: ready to use                      [%s]\n\n &quot;</span>, datestr(now()));</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                end</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;            <span class="keywordflow">catch</span> ME</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                <a class="code" href="classivis_1_1main_1_1_iv_main.html" title="Main (static) class for initialising and shutting down ivis. Should be the first and last ivis comman...">IvMain</a>.<a class="code" href="classivis_1_1main_1_1_iv_main.html#a41c9b082c0fd8ed4b52b5a5447785ad9" title="Shut down system and close eye-tracker connection.">finishUp</a>();</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                rethrow(ME);</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;            end</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;            <span class="comment">/* --------------------------------------------------------------</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment">             * update graphics %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% */</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;            drawnow();</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;            <span class="keywordflow">if</span> IsWin()</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                ShowHideWinTaskbarMex(0)</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            end</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        }</div>
<div class="line"><a name="l00417"></a><span class="lineno"><a class="code" href="classivis_1_1main_1_1_iv_main.html#a0893daf130991b64a82d2d32410f3863">  417</a></span>&#160;        <span class="keyword">static</span> noret::substitute <a class="code" href="classivis_1_1main_1_1_iv_main.html#a0893daf130991b64a82d2d32410f3863" title="Pause data collection (currently disabled).">pause</a>(matlabtypesubstitute InH) {</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;            fprintf(<span class="stringliteral">&quot; IvMain: WARNING: Pause disabled\n &quot;</span>);</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        }</div>
<div class="line"><a name="l00431"></a><span class="lineno"><a class="code" href="classivis_1_1main_1_1_iv_main.html#a41c9b082c0fd8ed4b52b5a5447785ad9">  431</a></span>&#160;        <span class="keyword">static</span> noret::substitute <a class="code" href="classivis_1_1main_1_1_iv_main.html#a41c9b082c0fd8ed4b52b5a5447785ad9" title="Shut down system and close eye-tracker connection.">finishUp</a>(matlabtypesubstitute verbosity) {</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;            <span class="keyword">import</span> ivis.audio.* ivis.classifier.* ivis.control.* ivis.log.* ivis.eyetracker.* ivis.graphic.* ivis.gui.* ivis.io.* ivis.main.* ivis.resources.* ivis.simulation.* ivis.test.*;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;            <span class="keywordflow">try</span>                </div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                <span class="comment">/*  Use specified verbosity (or default to 1 if unsure) */</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                <span class="keywordflow">if</span> nargin &lt; 1 || isempty(verbosity)</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                    <span class="keyword">try</span> <span class="comment">/*  will fail if IvParams not init yet */</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                        verbosity = ivis.main.IvParams.getInstance().main.verbosity;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                    <span class="keywordflow">catch</span> <span class="comment">/* #ok */</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                        verbosity = 1;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                    end</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                end</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                <span class="comment">/*  Print initial finishup message */</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                <span class="keywordflow">if</span> verbosity &gt; 0</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                    fprintf(<span class="stringliteral">&quot; \nIVIS: finishing up...\n &quot;</span>);</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                end</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                <span class="comment">/* restore default gamma table(s) */</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                scale=2^-0;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                masterGammaTable = ((1-scale)/2:scale/255:1-(1-scale)/2)^t*[1 1 1];</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                <span class="keywordflow">for</span> winhandle = <a class="code" href="namespaceivis_1_1broadcaster.html#a035702262427ed8c3b5b3d6d6d025b02" title="SCREEN wrapper for PTB&#39;s Screen command.">Screen</a>(<span class="stringliteral">&quot; Windows &quot;</span>)</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                    <a class="code" href="namespaceivis_1_1broadcaster.html#a035702262427ed8c3b5b3d6d6d025b02" title="SCREEN wrapper for PTB&#39;s Screen command.">Screen</a>(<span class="stringliteral">&quot; LoadNormalizedGammaTable &quot;</span>, winhandle, masterGammaTable);</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                end</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                <span class="keywordflow">if</span> IsWin()</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                    ShowHideWinTaskbarMex(1)</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                end</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                <span class="comment">/*  Shutdown/restore */</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                ShowCursor();</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                <a class="code" href="class_singleton_manager.html" title="Singleton manager class that maintains references to each Singleton object (and provides a mechanism ...">SingletonManager</a>.<a class="code" href="class_singleton_manager.html#ac2af0ef8b8934134aebd8b3d33dc7dec" title="Delete all Singletons. Print info to the console.">clearAll</a>(verbosity);</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                <span class="comment">/*  ensure that GUI is closed down (not sure which is more</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment">                 * important) - otherwise trying to close the window will</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment">                 * freeze operation */</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                drawnow();</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                FlushEvents();</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                <span class="comment">/*  close any open PTB screens */</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                fprintf(<span class="stringliteral">&quot; Closing PTB screens...\n &quot;</span>);</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                sca();</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                <span class="comment">/* Screen(&#39;closeall&#39;); % must come after SingletonManager.clearAll() to ensure IvVideo has a chance to destroy */</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                <span class="comment">/*  not sure about these:</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="comment">                 *clear IvMain; % does anything? */</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                clear GetCharJava <span class="comment">/*  does anything? */</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                clearJavaMem();</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                PsychJavaSwingCleanup(); <span class="comment">/*  replicates clearJavaMem */</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                <span class="comment">/*  Close any resources left open n.b.</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment">                 * don&#39;t close open files, since psychtestrig may already have</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="comment">                 * opened a file. Don&#39;t clear java memory, since we may have</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment">                 * previously (manually) opened a screen, in which case key</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="comment">                 * variables such as the fliprate will be stored in java memory</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="comment">                 * clearJavaMem</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="comment">                 * Close figures:</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment"> *                 try</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment"> *                     close(&#39;all&#39;, &#39;hidden&#39;);</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment"> *                 catch  %#ok do nothing</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment"> *                 end</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment"> *                 % Closing figures might fail if the CloseRequestFcn of a figure</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment"> *                 % blocks the execution. Fallback:</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="comment"> *                 AllFig = allchild(0);</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="comment"> *                 if ~isempty(AllFig)</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment"> *                     set(AllFig, &#39;CloseRequestFcn&#39;, &#39;&#39;, &#39;DeleteFcn&#39;, &#39;&#39;);</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment"> *                     delete(AllFig);</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment"> *                 end</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="comment"> * ^^^ this is silly, as it will also close any figure windows opened</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="comment"> * manually by the user (e.g., for debugging) */</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                <span class="comment">/*  Print final message */</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                <span class="keywordflow">if</span> verbosity &gt; 0</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                    fprintf(<span class="stringliteral">&quot; \nIVIS: ... all done. Have a nice day!    [%s]\n\n &quot;</span>, datestr(now()));</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                end</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                diary off</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;            <span class="keywordflow">catch</span> ME</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                diary off</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                rethrow(ME);</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;            end</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        }</div>
<div class="line"><a name="l00530"></a><span class="lineno"><a class="code" href="classivis_1_1main_1_1_iv_main.html#a33b5f86f1d81c8a3ee2ad920bcc342c8">  530</a></span>&#160;        <span class="keyword">static</span> noret::substitute <a class="code" href="classivis_1_1main_1_1_iv_main.html#a33b5f86f1d81c8a3ee2ad920bcc342c8" title="Clear mememory.">totalClear</a>() {</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;            close all;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;            clc();</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;            clearJavaMem();</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;            <a class="code" href="clear_abs_all_8m.html#acbd9097b185d4a7f5cce6af1d935a29d" title="Clear command window: clc;.">clearAbsAll</a>();</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        }</div>
<div class="line"><a name="l00546"></a><span class="lineno"><a class="code" href="classivis_1_1main_1_1_iv_main.html#a796f8b9733bb70906c27c34be9513fcd">  546</a></span>&#160;        <span class="keyword">static</span> noret::substitute <a class="code" href="classivis_1_1main_1_1_iv_main.html#a796f8b9733bb70906c27c34be9513fcd" title="Prevent Ivis from checking screen parameters on launch.">disableScreenChecks</a>() {</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;            setpref(<span class="stringliteral">&quot; ivis &quot;</span>,<span class="stringliteral">&quot; disableScreenChecks &quot;</span>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        }</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;};</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;}</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;}</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_ff8247d13baa4c7278b64786bdcd0aa5.html">+ivis</a></li><li class="navelem"><a class="el" href="dir_a680b51f6f7c96f73a9a80e3148d08fa.html">+main</a></li><li class="navelem"><a class="el" href="_iv_main_8m.html">IvMain.m</a></li>
    <li class="footer">Generated on Fri Sep 29 2017 09:38:10 for ivis by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
